<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Homepage Grid</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }
        .grid-item {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: center;
            position: relative;
            background: #f9f9f9;
        }
        .grid-item img {
            max-width: 32px;
            margin-bottom: 10px;
        }
        .edit-mode {
            display: none;
        }
        .buttons {
            margin-bottom: 20px;
        }
        .buttons button {
            margin-right: 10px;
            padding: 10px 20px;
        }
        .delete-button {
            position: absolute;
            top: 5px;
            right: 5px;
            background: red;
            color: white;
            border: none;
            cursor: pointer;
        }
        .grid-item.draggable {
            opacity: 0.5;
        }
        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .input-group input {
            flex: 1;
            padding: 10px;
        }
        .message {
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid;
            border-radius: 5px;
            display: none;
        }
        .message.success {
            border-color: green;
            color: green;
        }
        .message.error {
            border-color: red;
            color: red;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="message" id="message"></div>
        <div class="buttons">
            <button id="editButton">Edit Mode</button>
            <button id="renderButton">Render Mode</button>
        </div>
        <div class="edit-mode">
            <div class="input-group">
                <input type="text" id="websiteName" placeholder="Website Name">
                <input type="text" id="websiteUrl" placeholder="Website URL">
                <input type="text" id="faviconUrl" placeholder="Favicon URL (optional)">
                <button id="addWebsiteButton">Add Website</button>
            </div>
        </div>
        <div class="grid" id="websiteGrid"></div>
    </div>

    <script>
        // Utility functions
        const Utils = {
            isValidUrl: (url) => {
                try {
                    new URL(url);
                    return true;
                } catch (_) {
                    return false;
                }
            },
            saveToLocalStorage: (key, data) => {
                localStorage.setItem(key, JSON.stringify(data));
            },
            loadFromLocalStorage: (key) => {
                return JSON.parse(localStorage.getItem(key)) || [];
            },
            getFaviconUrl: (url) => {
                const domain = new URL(url).hostname;
                return `https://www.google.com/s2/favicons?domain=${domain}`;
            },
            showMessage: (message, type) => {
                const messageElement = document.getElementById('message');
                messageElement.textContent = message;
                messageElement.className = `message ${type}`;
                messageElement.style.display = 'block';
                setTimeout(() => {
                    messageElement.style.display = 'none';
                }, 3000);
            }
        };

        // Website Manager module
        const WebsiteManager = {
            websites: Utils.loadFromLocalStorage('websites'),

            init: function () {
                this.cacheDom();
                this.bindEvents();
                this.render();
            },

            cacheDom: function () {
                this.editButton = document.getElementById('editButton');
                this.renderButton = document.getElementById('renderButton');
                this.editMode = document.querySelector('.edit-mode');
                this.websiteGrid = document.getElementById('websiteGrid');
                this.addWebsiteButton = document.getElementById('addWebsiteButton');
                this.websiteNameInput = document.getElementById('websiteName');
                this.websiteUrlInput = document.getElementById('websiteUrl');
                this.faviconUrlInput = document.getElementById('faviconUrl');
            },

            bindEvents: function () {
                this.editButton.addEventListener('click', this.toggleEditMode.bind(this));
                this.renderButton.addEventListener('click', this.toggleRenderMode.bind(this));
                this.addWebsiteButton.addEventListener('click', this.addWebsite.bind(this));
                this.websiteGrid.addEventListener('click', this.handleGridClick.bind(this));
                this.websiteGrid.addEventListener('dragstart', this.onDragStart.bind(this));
                this.websiteGrid.addEventListener('dragover', this.onDragOver.bind(this));
                this.websiteGrid.addEventListener('drop', this.onDrop.bind(this));
            },

            render: function () {
                this.editMode.style.display === 'block' ? this.renderWebsitesForEdit() : this.renderWebsites();
            },

            toggleEditMode: function () {
                this.editMode.style.display = 'block';
                this.renderWebsitesForEdit();
            },

            toggleRenderMode: function () {
                this.editMode.style.display = 'none';
                this.renderWebsites();
            },

            renderWebsites: function () {
                this.websiteGrid.innerHTML = '';
                this.websites.forEach((website, index) => {
                    const websiteElement = this.createWebsiteElement(website, index, false);
                    this.websiteGrid.appendChild(websiteElement);
                });
            },

            renderWebsitesForEdit: function () {
                this.websiteGrid.innerHTML = '';
                this.websites.forEach((website, index) => {
                    const websiteElement = this.createWebsiteElement(website, index, true);
                    this.websiteGrid.appendChild(websiteElement);
                });
            },

            createWebsiteElement: function (website, index, isEditMode) {
                const websiteElement = document.createElement('div');
                websiteElement.classList.add('grid-item');
                websiteElement.setAttribute('draggable', 'true');
                websiteElement.setAttribute('data-index', index);
                const favicon = website.favicon ? `<img src="${website.favicon}" alt="Favicon">` : '';
                if (isEditMode) {
                    websiteElement.innerHTML = `
                        ${favicon}
                        <input type="text" value="${website.name}" data-index="${index}" class="website-name">
                        <input type="text" value="${website.url}" data-index="${index}" class="website-url">
                        <input type="text" value="${website.favicon || ''}" data-index="${index}" class="favicon-url" placeholder="Favicon URL">
                        <button class="delete-button" data-index="${index}">X</button>
                    `;
                } else {
                    websiteElement.innerHTML = `
                        ${favicon}
                        <a href="${website.url}" target="_blank">${website.name}</a>
                    `;
                }
                return websiteElement;
            },

            addWebsite: function () {
                const name = this.websiteNameInput.value.trim();
                const url = this.websiteUrlInput.value.trim();
                let favicon = this.faviconUrlInput.value.trim();
                if (name && url && Utils.isValidUrl(url)) {
                    if (!favicon) {
                        favicon = Utils.getFaviconUrl(url);
                    }
                    const newWebsite = { name, url, favicon };
                    this.websites.push(newWebsite);
                    this.websiteNameInput.value = '';
                    this.websiteUrlInput.value = '';
                    this.faviconUrlInput.value = '';
                    Utils.saveToLocalStorage('websites', this.websites);
                    this.renderWebsitesForEdit();
                    Utils.showMessage('Website added successfully!', 'success');
                } else {
                    Utils.showMessage('Please enter a valid website name and URL.', 'error');
                }
            },

            deleteWebsite: function (index) {
                this.websites.splice(index, 1);
                Utils.saveToLocalStorage('websites', this.websites);
                this.renderWebsitesForEdit();
                Utils.showMessage('Website deleted successfully!', 'success');
            },

            updateWebsites: function () {
                const nameInputs = document.querySelectorAll('.website-name');
                const urlInputs = document.querySelectorAll('.website-url');
                const faviconInputs = document.querySelectorAll('.favicon-url');
                this.websites = [];
                nameInputs.forEach((input, index) => {
                    const name = input.value;
                    const url = urlInputs[index].value;
                    const favicon = faviconInputs[index].value;
                    if (name && url) {
                        this.websites.push({ name, url, favicon: Utils.isValidUrl(favicon) ? favicon : null });
                    }
                });
                Utils.saveToLocalStorage('websites', this.websites);
            },

            onDragStart: function (e) {
                this.draggedItemIndex = e.target.getAttribute('data-index');
                e.target.classList.add('draggable');
            },

            onDragOver: function (e) {
                e.preventDefault();
            },

            onDrop: function (e) {
                e.preventDefault();
                const targetElement = e.target.closest('.grid-item');
                if (targetElement) {
                    const targetIndex = targetElement.getAttribute('data-index');
                    this.reorderWebsites(this.draggedItemIndex, targetIndex);
                }
                const draggableElements = this.websiteGrid.querySelectorAll('.draggable');
                draggableElements.forEach(el => el.classList.remove('draggable'));
                Utils.showMessage('Website order updated successfully!', 'success');
            },

            reorderWebsites: function (fromIndex, toIndex) {
                const draggedItem = this.websites[fromIndex];
                this.websites.splice(fromIndex, 1);
                this.websites.splice(toIndex, 0, draggedItem);
                Utils.saveToLocalStorage('websites', this.websites);
                this.renderWebsitesForEdit();
            },

            handleGridClick: function (e) {
                if (e.target.classList.contains('delete-button')) {
                    const index = e.target.getAttribute('data-index');
                    this.deleteWebsite(index);
                }
            }
        };

        // Initialize the Website Manager
        document.addEventListener('DOMContentLoaded', () => {
            WebsiteManager.init();
        });
    </script>
</body>
</html>
